# SynoAI
A Synology Surveillance Station notification system utilising DeepStack AI, inspired by Christopher Adams' [sssAI](https://github.com/Christofo/sssAI) implementation.

The aim of the solution is to reduce the noise generated by Synology Surveillance Station's motion detection by routing all motion events via a [Deepstack](https://deepstack.cc/) docker image to look for particular objects, e.g. people.

The problem with sssAI that this project is designed to solve is that it relies on the Synology notification system still in order to send motion alerts. Due to the delay between fetching the snapshot, processing the image using the AI and requesting the alert, it means that the image attached to the Synology notification is sometimes 5-10 seconds after the motion alert was originally trigger.

SynoAI aims to solve this problem by side-stepping the Synology notifications entirely by allowing other notification systems to be used.

## Features
* Triggered via an Action Rule from Synology Surveillance Station
* Processes the image to look for specific objects using an AI
* Produces an output image, using the original image at the point of motion detection
* Draws boxes over the original image to show where objects were detected
* Sends any number of notifications at the point of notification with the processed image attached.

## Supported AIs
* [Deepstack](https://deepstack.cc/)

## Supported Notification Integrations
* [Pushbullet](https://www.pushbullet.com/)
* HomeAssistant (TODO)
* Webhooks (TODO)

## Docker
SynoAI can be installed as a docker image, which is [available from DockerHub](https://hub.docker.com/r/djdd87/synoai).

### Docker Configuration
The image can be pulled using the Docker cli by calling:
```
docker pull djdd87/synoai:latest
```
To run the image a volume must be specified to map your appsettings.json file. Additionally a port needs mapping to port 80 in order to trigger the API. Optionally, the Captures directory can also be mapped to easily expose all the images output from SynoAI.

```
docker run 
  -v /path/appsettings.json:/app/appsettings.json 
  -v /path/captures:/app/Captures 
  -p 8080:80 djdd87/synoai:latest
```

### Docker-Compose
```yaml
version: '3.4'

services:
  synoai:
    image: djdd87/synoai:latest
    build:
      context: .
      dockerfile: ./Dockerfile
    ports:
      - "8080:80"
    volumes:
      - /docker/synoai/captures:/app/Captures
      - /docker/synoai/appsettings.json:/app/appsettings.json
```

## Example appsettings.json
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information"
    }
  },

  "Url": "http://192.168.0.0:5000",
  "User": "SynologyUser",
  "Password": "SynologyPassword",

  "AI": {
    "Type": "DeepStack",
    "Url": "http://10.0.0.10:83",
    "MinSizeX": 100,
    "MinSizeY": 100
  },

  "Notifier": {
    "Type": "Pushbullet",
    "ApiKey": "0.123456789"
  },

  "Cameras": [
    {
      "Name": "Driveway",
      "Types": [ "Person", "Car" ],
      "Threshold": 45
    },
    {
      "Name": "BackDoor",
      "Types": [ "Person" ],
      "Threshold": 30
    }
  ]
}
```
